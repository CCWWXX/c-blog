{"version":3,"sources":["webpack:///webpack/bootstrap 1bfed3625b1101df3ee2","webpack:///./server/model/resModel.js","webpack:///./server/conf/db.js","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///./server/db/mysql.js","webpack:///./server/middleware/loginCheck.js","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///external \"koa-json\"","webpack:///external \"koa-onerror\"","webpack:///external \"koa-body\"","webpack:///external \"koa-logger\"","webpack:///external \"koa-generic-session\"","webpack:///external \"koa-redis\"","webpack:///external \"koa-morgan\"","webpack:///external \"koa-static\"","webpack:///./server/routes/blog.js","webpack:///./server/controller/blog.js","webpack:///external \"xss\"","webpack:///external \"mysql\"","webpack:///./server-config.json","webpack:///external \"dayjs\"","webpack:///./server/middleware/imageCheck.js","webpack:///./server/utils/uploadImg.js","webpack:///./server/routes/user.js","webpack:///./server/controller/user.js","webpack:///./server/utils/cryp.js","webpack:///external \"crypto\"","webpack:///./nuxt.config.js","webpack:///./cdn.json","webpack:///./front-config.json"],"names":["BaseModel","constructor","data","message","SuccessModel","errno","ErrorModel","module","exports","allConfig","require","process","prod","dev","mysql","con","createConnection","MYSQL_CONF","connect","exec","sql","promise","Promise","resolve","reject","query","err","result","escape","ctx","next","session","username","body","Koa","Nuxt","Builder","json","onerror","koaBody","logger","redisStore","path","fs","morgan","KoaStatic","blog","user","REDIS_CONF","start","app","host","port","config","env","use","join","__dirname","multipart","formidable","maxFileSize","redisClient","all","on","console","log","keys","redisKeys","cookie","httpOnly","maxAge","store","nuxt","builder","build","routes","allowedMethods","status","respond","req","render","res","listen","router","getList","getDetail","starBlog","checkStar","newBlog","createComment","getComment","loginCheck","imageCheck","uploadImg","prefix","get","author","isadmin","error","userId","user_id","listData","id","newView","post","request","articleId","article_id","url","xss","dayjs","keyword","page","pageSize","page_size","totalSql","total","val","starSql","starData","stars","length","isStart","find","item","isStar","Number","upDateViewsSql","rows","blogData","starTime","Date","now","format","insertData","affectedRows","title","content","description","logo","createTime","insertId","userSql","parentId","parent_id","commentTime","type","files","isImage","test","time","getTime","reader","createReadStream","filePath","remotefilePath","upStream","createWriteStream","pipe","login","password","realname","genPassword","crypto","SECRET_KEY","secret_key","md5","createHash","update","digest","str","cdnConfig","mode","head","meta","charset","name","hid","link","rel","href","script","js","modules","css","middleware","styleResources","scss","plugins","src","ssr","loading","color","extend","Client","rules","push","enforce","loader","exclude"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1bfed3625b1101df3ee2","class BaseModel {\r\n  constructor(data, message) {\r\n    if (typeof data === 'string') {\r\n      this.message = data\r\n      data = null\r\n      message = null\r\n    }\r\n    if (data) {\r\n      this.data = data\r\n    }\r\n    if (message) {\r\n      this.message = message\r\n    }\r\n  }\r\n}\r\n\r\nclass SuccessModel extends BaseModel {\r\n  constructor(data, message) {\r\n    super(data, message)\r\n    this.errno = 0\r\n  }\r\n}\r\n\r\nclass ErrorModel extends BaseModel {\r\n  constructor(data, message) {\r\n    super(data, message)\r\n    this.errno = -1\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  SuccessModel,\r\n  ErrorModel\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/resModel.js","let allConfig = require('../../server-config.json')\r\nallConfig = process.env.NODE_ENV === 'production' ? allConfig.prod : allConfig.dev\r\n\r\nmodule.exports = allConfig\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/conf/db.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 4\n// module chunks = 0","const mysql = require('mysql')\r\nconst allConfig = require('../conf/db')\r\n\r\n// 创建链接对象\r\nconst con = mysql.createConnection(allConfig.MYSQL_CONF)\r\n\r\n// 开始链接\r\ncon.connect()\r\n\r\n// 统一执行 sql 的函数\r\nfunction exec(sql) {\r\n  const promise = new Promise((resolve, reject) => {\r\n    con.query(sql, (err, result) => {\r\n      if (err) {\r\n        reject(err)\r\n        return\r\n      }\r\n      resolve(result)\r\n    })\r\n  })\r\n  return promise\r\n}\r\n\r\nmodule.exports = {\r\n  exec,\r\n  escape: mysql.escape\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/db/mysql.js","const { ErrorModel } = require('../model/resModel')\r\n\r\nmodule.exports = async (ctx, next) => {\r\n  if (ctx.session.username) {\r\n    await next()\r\n    return\r\n  }\r\n  ctx.body = new ErrorModel('未登录或登陆信息已失效')\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/loginCheck.js","const Koa = require('koa')\r\nconst { Nuxt, Builder } = require('nuxt')\r\n\r\nconst json = require('koa-json')\r\nconst onerror = require('koa-onerror')\r\n// const bodyparser = require('koa-bodyparser')\r\nconst koaBody = require('koa-body') // 解析上传文件的插件\r\nconst logger = require('koa-logger')\r\nconst session = require('koa-generic-session')\r\nconst redisStore = require('koa-redis')\r\nconst path = require('path')\r\nconst fs = require('fs')\r\nconst morgan = require('koa-morgan')\r\nconst KoaStatic = require('koa-static')\r\n\r\nconst blog = require('./routes/blog')\r\nconst user = require('./routes/user')\r\n\r\nconst allConfig = require('./conf/db')\r\nconst REDIS_CONF = allConfig.REDIS_CONF\r\n\r\nasync function start() {\r\n  const app = new Koa()\r\n  const host = allConfig.host || '127.0.0.1'\r\n  const port = allConfig.port || 8002\r\n\r\n  // Import and Set Nuxt.js options\r\n  const config = require('../nuxt.config.js')\r\n  config.dev = !(app.env === 'production')\r\n  // error handler\r\n  onerror(app)\r\n  // 访问静态资源\r\n  app.use(KoaStatic(path.join(__dirname, 'static')))\r\n  // middlewares\r\n  // app.use(bodyparser({\r\n  //   enableTypes: ['json', 'form', 'text']\r\n  // }))\r\n  app.use(koaBody({\r\n    multipart: true,\r\n    formidable: {\r\n      maxFileSize: 2000 * 1024 * 1024    // 设置上传文件大小最大限制，默认2M\r\n    }\r\n  }))\r\n  app.use(json())\r\n  // app.use(logger())\r\n\r\n// logger\r\n  // app.use(async (ctx, next) => {\r\n  //   const start = new Date()\r\n  //   await next()\r\n  //   const ms = new Date() - start\r\n  //   console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\r\n  // })\r\n\r\n  // const ENV = process.env.NODE_ENV\r\n  // if (ENV !== 'production') {\r\n  // // 开发环境 / 测试环境\r\n  //   app.use(morgan('dev'))\r\n  // } else {\r\n  // // 线上环境\r\n  //   const logFileName = path.join(__dirname, 'logs', 'access.log')\r\n  //   const writeStream = fs.createWriteStream(logFileName, {\r\n  //     flags: 'a'\r\n  //   })\r\n  //   app.use(morgan('combined', {\r\n  //     stream: writeStream\r\n  //   }))\r\n  // }\r\n\r\n// session 配置\r\n  let redisClient = redisStore({\r\n    // all: '127.0.0.1:6379'   // 写死本地的 redis\r\n    all: `${REDIS_CONF.host}:${REDIS_CONF.port}`\r\n  })\r\n  redisClient.on('error', (err) => {\r\n    // 打印redis连接报错\r\n    console.log('redisError:', err)\r\n  })\r\n  app.keys = REDIS_CONF.redisKeys\r\n  app.use(session({\r\n  // 配置 cookie\r\n    cookie: {\r\n      path: '/',\r\n      httpOnly: true,\r\n      maxAge: 24 * 60 * 60 * 1000\r\n    },\r\n  // 配置 redis\r\n    store: redisClient\r\n  }))\r\n\r\n// Instantiate nuxt.js\r\n  const nuxt = new Nuxt(config)\r\n\r\n// Build in development\r\n  if (config.dev) {\r\n    const builder = new Builder(nuxt)\r\n    await builder.build()\r\n  }\r\n\r\n// routes\r\n  app.use(blog.routes(), blog.allowedMethods())\r\n  app.use(user.routes(), user.allowedMethods())\r\n  app.use(ctx => {\r\n    ctx.status = 200\r\n    ctx.respond = false // Mark request as handled for Koa\r\n    ctx.req.ctx = ctx // This might be useful later on, e.g. in nuxtServerInit or with nuxt-stash\r\n    nuxt.render(ctx.req, ctx.res)\r\n  })\r\n  app.listen(port, host)\r\n  console.log(`Server listening on http://${host}:${port}`) // eslint-disable-line no-console\r\n}\r\n\r\nstart()\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa-json\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-json\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"koa-onerror\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-onerror\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"koa-logger\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-logger\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"koa-generic-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-generic-session\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"koa-redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-redis\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"koa-morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-morgan\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 17\n// module chunks = 0","const router = require('koa-router')()\r\nconst {\r\n  getList,\r\n  getDetail,\r\n  starBlog,\r\n  checkStar,\r\n  newBlog,\r\n  createComment,\r\n  getComment\r\n} = require('../controller/blog')\r\nconst { SuccessModel, ErrorModel } = require('../model/resModel')\r\nconst loginCheck = require('../middleware/loginCheck')\r\nconst imageCheck = require('../middleware/imageCheck')\r\nconst { uploadImg } = require('../utils/uploadImg')\r\n\r\nrouter.prefix('/api/blog')\r\n\r\nrouter.get('/list', async function (ctx, next) {\r\n  let author = ctx.query.author || ''\r\n  if (ctx.query.isadmin) {\r\n    console.log('is admin')\r\n    // 管理员界面\r\n    if (ctx.session.username == null) {\r\n      console.error('is admin, but no login')\r\n      // 未登录\r\n      ctx.body = new ErrorModel('未登录')\r\n      return\r\n    }\r\n    // 强制查询自己的博客\r\n    author = ctx.session.username\r\n  }\r\n  const userId = ctx.session.user_id\r\n  const listData = await getList(author, userId, ctx.query)\r\n  ctx.body = new SuccessModel(listData)\r\n})\r\n\r\nrouter.get('/detail', async function (ctx, next) {\r\n  const data = await getDetail(ctx.query.id, ctx.query.newView)\r\n  ctx.body = new SuccessModel(data)\r\n})\r\n\r\nrouter.post('/star', async function (ctx, next) {\r\n  const userId = ctx.session.user_id\r\n  const data = await starBlog(userId, ctx.request.body)\r\n  if (data) {\r\n    ctx.body = new SuccessModel()\r\n  } else {\r\n    ctx.body = new ErrorModel('操作失败')\r\n  }\r\n})\r\n\r\nrouter.get('/checkStar', async function (ctx, next) {\r\n  const articleId = ctx.query.article_id || ''\r\n  const data = await checkStar(ctx.session.user_id, articleId)\r\n  ctx.body = new SuccessModel(data)\r\n})\r\n\r\nrouter.post('/new', loginCheck, async function (ctx, next) {\r\n  const body = ctx.request.body\r\n  body.author = ctx.session.username\r\n  const data = await newBlog(body)\r\n  ctx.body = new SuccessModel(data)\r\n})\r\n\r\nrouter.post('/upload', loginCheck, imageCheck, async function (ctx, next) {\r\n  const url = await uploadImg(ctx)\r\n  if (url) {\r\n    ctx.body = new SuccessModel({url: url})\r\n  } else {\r\n    ctx.body = new ErrorModel('')\r\n  }\r\n})\r\n\r\nrouter.post('/createComment', loginCheck, async function (ctx, next) {\r\n  const body = ctx.request.body\r\n  const userId = ctx.session.user_id\r\n  const data = await createComment(userId, body)\r\n  ctx.body = new SuccessModel(data)\r\n})\r\n\r\nrouter.get('/comment', async function (ctx, next) {\r\n  const data = await getComment(ctx.query)\r\n  ctx.body = new SuccessModel(data)\r\n})\r\n\r\nmodule.exports = router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/blog.js","const xss = require('xss')\r\nconst { exec } = require('../db/mysql')\r\nconst dayjs = require('dayjs')\r\n\r\nconst getList = async (author, userId, query) => {\r\n  const keyword = query.keyword || ''\r\n  const page = query.page || 1\r\n  const pageSize = query.page_size || 10\r\n  let sql = `select * from blogs where 1=1 `\r\n  if (author) {\r\n    sql += `and author='${author}' `\r\n  }\r\n  if (keyword) {\r\n    sql += `and title like '%${keyword}%' or description like '%${keyword}%'`\r\n  }\r\n  // 时间反序和分页\r\n  sql += `order by createtime desc limit ${(page - 1) * pageSize}, ${pageSize};`\r\n  let listData = await exec(sql)\r\n  const totalSql = `select count(id) from blogs`\r\n  const total = await exec(totalSql)\r\n  for (let val of listData) {\r\n    const starSql = `select * from stars where article_id='${val.id}'`\r\n    const starData = await exec(starSql)\r\n    // 该文章点赞数\r\n    val.stars = starData.length\r\n    // 当前用户是否点赞该文章\r\n    let isStart\r\n    if (userId) {\r\n      isStart = !!starData.find(item => item.user_id === userId)\r\n    }\r\n    val.isStar = isStart\r\n  }\r\n  const data = {\r\n    listData: listData,\r\n    page: page,\r\n    pageSize: pageSize,\r\n    total: total[0]['count(id)']\r\n  }\r\n  return data\r\n}\r\n\r\nconst getDetail = async (id, newView) => {\r\n  // 是否要增加一次预览\r\n  if (Number(newView)) {\r\n    const upDateViewsSql = `update blogs set views=views+1 where id='${id}'`\r\n    await exec(upDateViewsSql)\r\n  }\r\n  const starSql = `select * from stars where article_id='${id}'`\r\n  const starData = await exec(starSql)\r\n  const sql = `select * from blogs where id='${id}'`\r\n  const rows = await exec(sql)\r\n  // 该文章点赞数\r\n  rows[0].stars = starData.length\r\n  // // 判断当前用户是否点赞\r\n  // let isStart = !!starData.find(item => item.user_id === userId)\r\n  // rows[0].isStar = isStart\r\n  return rows[0]\r\n}\r\n\r\nconst starBlog = async (userId, blogData = {}) => {\r\n  const articleId = blogData.article_id\r\n  const status = blogData.status\r\n  const starTime = dayjs(Date.now()).format('YYYY-MM-DD HH:mm:ss')\r\n  let sql\r\n  if (Number(status)) {\r\n    sql = `insert into stars (user_id, article_id, star_time) values ('${userId}', '${articleId}', '${starTime}');`\r\n  } else {\r\n    sql = `delete from stars where article_id='${articleId}' and user_id='${userId}';`\r\n  }\r\n  const insertData = await exec(sql)\r\n  if (insertData.affectedRows > 0) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\n// 验证当前文章是否点赞，由于服务端渲染，cookie验证的接口单独拿出来\r\nconst checkStar = async (userId, articleId) => {\r\n  const starSql = `select * from stars where article_id='${articleId}' and user_id='${userId}'`\r\n  const starData = await exec(starSql)\r\n  // 判断当前用户是否点赞\r\n  let isStart = starData && starData.length\r\n  return { isStar: isStart }\r\n}\r\n\r\nconst newBlog = async (blogData = {}) => {\r\n  const title = xss(blogData.title)\r\n  // xss会影响富文本\r\n  const content = blogData.content\r\n  const description = xss(blogData.description)\r\n  const logo = xss(blogData.logo)\r\n  const author = blogData.author\r\n  const createTime = dayjs(Date.now()).format('YYYY-MM-DD HH:mm:ss')\r\n\r\n  const sql = `\r\n        insert into blogs (title, content, description, logo, createtime, author)\r\n        values ('${title}', '${content}', '${description}', '${logo}', '${createTime}', '${author}');\r\n    `\r\n\r\n  const insertData = await exec(sql)\r\n  return {\r\n    id: insertData.insertId\r\n  }\r\n}\r\n\r\nconst createComment = async (userId, blogData = {}) => {\r\n  const userSql = `select username from users where id=${userId}`\r\n  const user = await exec(userSql)\r\n  const author = user[0].username\r\n  // xss会影响富文本\r\n  const content = xss(blogData.content)\r\n  const parentId = blogData.parent_id || -1\r\n  const articleId = blogData.article_id\r\n  const commentTime = dayjs(Date.now()).format('YYYY-MM-DD HH:mm:ss')\r\n\r\n  const sql = `\r\n        insert into comments (author, content, comment_time, user_id, parent_id, article_id)\r\n        values ('${author}', '${content}', '${commentTime}', '${userId}', '${parentId}', '${articleId}');\r\n    `\r\n\r\n  const insertData = await exec(sql)\r\n  return {\r\n    id: insertData.insertId\r\n  }\r\n}\r\n\r\nconst getComment = async (query) => {\r\n  const articleId = query.article_id\r\n  const sql = `select * from comments where article_id=${articleId}`\r\n\r\n  const data = await exec(sql)\r\n  return data\r\n}\r\n\r\nmodule.exports = {\r\n  getList,\r\n  getDetail,\r\n  starBlog,\r\n  checkStar,\r\n  newBlog,\r\n  createComment,\r\n  getComment\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controller/blog.js","module.exports = require(\"xss\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xss\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"mysql\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mysql\"\n// module id = 21\n// module chunks = 0","module.exports = {\"dev\":{\"host\":\"127.0.0.1\",\"port\":\"8002\",\"secret_key\":\"ccc1456#\",\"MYSQL_CONF\":{\"host\":\"localhost\",\"user\":\"root\",\"password\":\"a123456\",\"port\":\"3306\",\"database\":\"myblog\"},\"REDIS_CONF\":{\"port\":\"6379\",\"host\":\"127.0.0.1\",\"redisKeys\":[\"ccc456#555_\"]}},\"prod\":{\"host\":\"127.0.0.1\",\"port\":\"8003\",\"secret_key\":\"ccc1456#\",\"MYSQL_CONF\":{\"host\":\"localhost\",\"user\":\"root\",\"password\":\"a123456\",\"port\":\"3306\",\"database\":\"myblog\"},\"REDIS_CONF\":{\"port\":\"6379\",\"host\":\"127.0.0.1\",\"redisKeys\":[\"ccc456#555_\"]}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server-config.json\n// module id = 22\n// module chunks = 0","module.exports = require(\"dayjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dayjs\"\n// module id = 23\n// module chunks = 0","const { ErrorModel } = require('../model/resModel')\r\n\r\nmodule.exports = async (ctx, next) => {\r\n  let type = ctx.request.files['image'].type\r\n  const isImage = /(jpeg|png)$/.test(type)\r\n  if (isImage) {\r\n    await next()\r\n    return\r\n  }\r\n  ctx.body = new ErrorModel('图片上传格式错误')\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/imageCheck.js"," // 上传图片\r\nconst fs = require('fs')\r\nconst path = require('path')\r\nfunction uploadImg(ctx) {\r\n  const promise = new Promise((resolve, reject) => {\r\n    let time = new Date().getTime()\r\n    // 创建可读流\r\n    const reader = fs.createReadStream(ctx.request.files['image']['path'])\r\n    let filePath = path.join(__dirname, '../', '../', 'static/image', `/${time}${ctx.request.files['image']['name']}`)\r\n    // let filePath = `./static` + `/${ctx.request.files['image']['name']}`\r\n    let remotefilePath = `http://127.0.0.1:8002/image` + `/${time}${ctx.request.files['image']['name']}`\r\n    // 创建可写流\r\n    const upStream = fs.createWriteStream(filePath)\r\n    // 可读流通过管道写入可写流\r\n    reader.pipe(upStream)\r\n    reader.on('end', () => {\r\n      resolve(remotefilePath)\r\n    })\r\n    reader.on('error', () => {\r\n      resolve(false)\r\n    })\r\n  })\r\n  return promise\r\n}\r\nmodule.exports = {\r\n  uploadImg\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/uploadImg.js","const router = require('koa-router')()\r\nconst { login } = require('../controller/user')\r\nconst { SuccessModel, ErrorModel } = require('../model/resModel')\r\nconst loginCheck = require('../middleware/loginCheck')\r\n\r\nrouter.prefix('/api/user')\r\n\r\nrouter.post('/login', async function (ctx, next) {\r\n  const { username, password } = ctx.request.body\r\n  const data = await login(username, password)\r\n  if (data.username) {\r\n    // 设置 session\r\n    ctx.session.username = data.username\r\n    ctx.session.realname = data.realname\r\n    ctx.session.user_id = data.id\r\n\r\n    ctx.body = new SuccessModel(data)\r\n    return\r\n  }\r\n  ctx.body = new ErrorModel('登录失败')\r\n})\r\n\r\nrouter.get('/info', loginCheck, async function (ctx, next) {\r\n  const data = {\r\n    username: ctx.session.username,\r\n    realname: ctx.session.realname\r\n  }\r\n  if (data) {\r\n    ctx.body = new SuccessModel(data)\r\n  } else {\r\n    ctx.body = new ErrorModel('更新博客失败')\r\n  }\r\n})\r\n\r\nrouter.get('/logout', loginCheck, async function (ctx, next) {\r\n  ctx.session.username = null\r\n  ctx.session.realname = null\r\n  ctx.session.user_id = null\r\n  ctx.body = new SuccessModel('注销成功')\r\n})\r\n\r\nmodule.exports = router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/user.js","const { exec, escape } = require('../db/mysql')\nconst { genPassword } = require('../utils/cryp')\n\nconst login = async (username, password) => {\n  username = escape(username)\n\n    // 生成加密密码\n  password = genPassword(password)\n  password = escape(password)\n\n  const sql = `\n        select username, realname, id from users where username=${username} and password=${password}\n    `\n  const rows = await exec(sql)\n  return rows[0] || {}\n}\n\nmodule.exports = {\n  login\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controller/user.js","const crypto = require('crypto')\nconst allConfig = require('../conf/db')\n\n// 密匙\nconst SECRET_KEY = allConfig.secret_key\n\n// md5 加密\nfunction md5(content) {\n  let md5 = crypto.createHash('md5')\n  return md5.update(content).digest('hex')\n}\n\n// 加密函数\nfunction genPassword(password) {\n  const str = `password=${password}&key=${SECRET_KEY}`\n  return md5(str)\n}\n\nmodule.exports = {\n  genPassword\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/cryp.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 29\n// module chunks = 0","const cdnConfig = require('./cdn.json')\r\nconst env =\r\n    process.env.NODE_ENV === 'production'\r\n        ? require('./front-config.json').prod\r\n        : require('./front-config.json').dev\r\nmodule.exports = {\r\n  // mode: 'spa',\r\n  mode: 'universal', // 服务端渲染\r\n  env,\r\n  /*\r\n  ** Headers of the page\r\n  */\r\n  head: {\r\n    title: 'c-blog',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ],\r\n    script: cdnConfig.js\r\n    // script: [\r\n    //   { src: require('./utils/lodash.js'), type: 'text/javascript' }\r\n    // ]\r\n  },\r\n  /*\r\n  ** Nuxt.js modules\r\n  */\r\n  modules: [\r\n    '@nuxtjs/style-resources'\r\n  ],\r\n  /*\r\n  ** Global CSS\r\n  */\r\n  css: [\r\n    '~assets/css/main.css',\r\n    '~assets/style/common.scss',\r\n    'element-ui/lib/theme-chalk/index.css',\r\n    'quill/dist/quill.snow.css',\r\n    'quill/dist/quill.bubble.css',\r\n    'quill/dist/quill.core.css'\r\n  ],\r\n  /*\r\n  ** Customize the progress-bar color\r\n  */\r\n  router: {\r\n    middleware: ['auth']\r\n  },\r\n  styleResources: {\r\n    scss: [\r\n      '@/assets/vars/*.scss' // 自己项目中的样式文件的路径\r\n    ]\r\n  },\r\n  plugins: [\r\n    {\r\n      src: '~plugins/ElementUI',\r\n      ssr: true\r\n    },\r\n    {\r\n      src: '~plugins/day',\r\n      ssr: false\r\n    },\r\n    {\r\n      src: '~plugins/lodash.js',\r\n      ssr: false\r\n    },\r\n    {\r\n      src: '~/plugins/vue-quill-editor',\r\n      ssr: false\r\n    },\r\n    {\r\n      src: '~/plugins/eventlistener',\r\n      ssr: false\r\n    }\r\n  ],\r\n  loading: { color: '#60aedd' },\r\n  /*\r\n   ** Build configuration\r\n   */\r\n  build: {\r\n    /*\r\n     ** Run ESLINT on save\r\n     */\r\n    extend(config, ctx) {\r\n      if (ctx.Client) {\r\n        config.module.rules.push({\r\n          enforce: 'pre',\r\n          test: /\\.(js|vue)$/,\r\n          loader: 'eslint-loader',\r\n          exclude: /(node_modules)/\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","module.exports = {\"js\":[{\"src\":\"https://cdn.staticfile.org/particles.js/2.0.0/particles.min.js\"}],\"css\":[]}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./cdn.json\n// module id = 31\n// module chunks = 0","module.exports = {\"dev\":{\"apiUrl\":\"http://127.0.0.1:8002/\"},\"prod\":{\"apiUrl\":\"http://127.0.0.1:8003/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./front-config.json\n// module id = 32\n// module chunks = 0"],"sourceRoot":""}